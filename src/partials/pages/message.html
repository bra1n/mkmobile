<header ng-class="{loading:data.loading}">
  <a href="/messages" class="back"></a>
  {{data.partner.username}}
  <span class="icons" mkm-user ng-show="data.partner" user="data.partner"></span>
</header>
<article>
  <form class="search subheadline" ng-submit="blur($event)" ng-show="data.messages && data.messages.length">
    <div class="left">
      <input id="search" type="text" ng-model="searchText" placeholder="{{'common.search' | translate}}">
    </div>
    <div class="right">
      <button type="button" ng-show="searchText" ng-click="searchText = ''">{{'search.cancel' | translate}}</button>
    </div>
  </form>
  <ul class="thread" ng-class="{loading:data.loading}">
    <li ng-repeat="message in data.messages | filter:searchText"
        ng-class="{sending: message.isSending, unread: message.unread}">
      <h3 ng-show="!$index || message.date.toDateString() != data.messages[$index - 1].date.toDateString()">
        {{message.date | date:'fullDate'}}
      </h3>
      <div>
        <button class="remove" ng-click="delete($index,data.partner.idUser,message.idMessage)"></button>
        <span class="time">{{message.date | date:'shortTime'}}</span>
        <p>{{message.text}}</p>
      </div>
    </li>
  </ul>
  <form class="write subheadline" ng-submit="send()">
    <div class="left">
      <textarea placeholder="{{'messages.message' | translate}}" required ng-model="message"></textarea>
    </div>
    <div class="right">
      <button translate="messages.send">Send</button>
    </div>
  </form>
</article>
<mkm-footer messages="unreadCount"></mkm-footer>