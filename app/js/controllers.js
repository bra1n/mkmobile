// Generated by CoffeeScript 1.7.1
var mkmobileControllers;

mkmobileControllers = angular.module('mkmobileControllers', []);

mkmobileControllers.controller('SearchCtrl', [
  '$scope', '$routeParams', '$location', 'MkmApi', '$sce', function($scope, $routeParams, $location, MkmApi, $sce) {
    if ($location.path() === "/") {
      MkmApi.checkLogin();
    }
    $scope.search = function() {
      return $scope.data = MkmApi.search($scope.query);
    };
    $scope.updateHistory = function() {
      return $location.search({
        search: $scope.query
      });
    };
    $scope.query = $routeParams.search;
    $scope.search();
    $scope.sort = "name";
    $scope.loadResults = function() {
      if ($scope.data.products.length >= $scope.data.count || $scope.data.loading) {
        return;
      }
      return MkmApi.search($scope.query, $scope.data);
    };
    $scope.loggedIn = MkmApi.isLoggedIn();
    $scope.handleLogin = function() {
      $scope.iframeSrc = $sce.trustAsResourceUrl(MkmApi.getLoginURL());
      return window.handleCallback = function(token) {
        $scope.iframeSrc = null;
        $scope.login = MkmApi.getAccess(token);
        return delete window.handleCallback;
      };
    };
    return $scope.logout = function() {
      MkmApi.logout();
      return $scope.loggedIn = false;
    };
  }
]);

mkmobileControllers.controller('ProductCtrl', [
  '$scope', '$routeParams', 'MkmApi', function($scope, $routeParams, MkmApi) {
    $scope.productData = MkmApi.product($routeParams.productId);
    $scope.data = MkmApi.articles($routeParams.productId);
    $scope.cart = MkmApi.getCartCount();
    $scope.loadArticles = function() {
      if ($scope.data.articles.length >= $scope.data.count || $scope.data.loading) {
        return;
      }
      return MkmApi.articles($routeParams.productId, $scope.data);
    };
    return $scope.addToCart = function(article) {
      MkmApi.checkLogin();
      return MkmApi.addToCart(article.idArticle, function() {
        article.count--;
        return $scope.cart = MkmApi.getCartCount();
      });
    };
  }
]);

mkmobileControllers.controller('SettingsCtrl', [
  '$scope', 'MkmApi', function($scope, MkmApi) {
    MkmApi.checkLogin();
    $scope.vacation = false;
    return $scope.logout = function() {
      return MkmApi.logout();
    };
  }
]);

mkmobileControllers.controller('HomeCtrl', [
  '$scope', 'MkmApi', function($scope, MkmApi) {
    return MkmApi.checkLogin();
  }
]);

mkmobileControllers.controller('CallbackCtrl', [
  '$scope', '$location', function($scope, $location) {
    var search, _base;
    search = $location.search();
    if (search['request_token'] != null) {
      return typeof (_base = window.parent).handleCallback === "function" ? _base.handleCallback(search['request_token']) : void 0;
    }
  }
]);

//# sourceMappingURL=controllers.map
