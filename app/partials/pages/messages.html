<header translate="titles.messages">My Messages</header>
<article>
  <div class="search subheadline">
    <div class="left">
      <input id="search" type="text" placeholder="{{'common.search' | translate}}" ng-model="search">
    </div>
    <div class="right">
      <button ng-show="search" ng-click="search = ''">{{'search.cancel' | translate}}</button>
    </div>
  </div>
  <ul class="overview" ng-class="{loading:data.loading}">
    <li ng-repeat="thread in data.messages | filter:search" class="link"
        ng-class="{sending:thread.message.isSending, unread:thread.unreadMessages}">
      <button ng-click="delete($index,thread.partner.idUser)"></button>
      <span class="time">{{thread.message.date | date:'short'}}</span>
      <a href="/messages/{{thread.partner.idUser}}">
        <span class="title">
          {{thread.partner.username}}
          <span mkm-user user="thread.partner"></span>
        </span>
        <p>{{thread.message.text | truncate:150}}</p>
      </a>
    </li>
    <li class="user" ng-repeat="user in users">
      <a href="/messages/{{user.idUser}}">
        <span class="title">
          {{user.username}}
          <span mkm-user user="user"></span>
        </span>
        <p translate="messages.new">Write a new message</p>
      </a>
    </li>
  </ul>
</article>
<mkm-footer messages="unreadCount"></mkm-footer>